# Reading training set;
datasettrain <- read.csv(".//getdata_projectfiles_UCI HAR Dataset//UCI HAR Dataset//train//X_train.txt", sep = "", header = FALSE)

# Reading test set;
datasettest <- read.csv(".//getdata_projectfiles_UCI HAR Dataset//UCI HAR Dataset//test//X_test.txt", sep = "", header = FALSE)

# Reading training labels;
labelstrain <- read.csv(".//getdata_projectfiles_UCI HAR Dataset//UCI HAR Dataset//train//y_train.txt", sep = "", header = FALSE)

# Reading test labels;
labelstest <- read.csv(".//getdata_projectfiles_UCI HAR Dataset//UCI HAR Dataset//test//y_test.txt", sep = "", header = FALSE)

# Reading training labels;
subjecttrain <- read.csv(".//getdata_projectfiles_UCI HAR Dataset//UCI HAR Dataset//train//subject_train.txt", sep = "", header = FALSE)

# Reading test labels;
subjecttest <- read.csv(".//getdata_projectfiles_UCI HAR Dataset//UCI HAR Dataset//test//subject_test.txt", sep = "", header = FALSE)

# Concatenating subject, labels and set
# training
datasettraincomplete <- cbind(subjecttrain,labelstrain,datasettrain)
# Test
datasettestcomplete <- cbind(subjecttest,labelstest,datasettest)


# 1.Merges the training and the test sets to create one data set.
# Concatenating training and test sets
dataset <- rbind(datasettraincomplete,datasettestcomplete)

# 2.Extracts only the measurements on the mean and standard deviation for each measurement.
# Mean and standard deviation for each column;
# Mean
datasetmean<-sapply(dataset[,3:563], mean)
# Standard deviation;
datasetsd<-sapply(dataset[,3:563], sd)

# 3. Uses descriptive activity names to name the activities in the data set.
# Replace 1 to WALKING
dataset[,2]<- gsub(1,"WALKING",dataset[,2])
# Replace 2 to WALKING_UPSTAIRS
dataset[,2]<- gsub(2,"WALKING_UPSTAIRS",dataset[,2])
# Replace 3 to WALKING_DOWNSTAIRS
dataset[,2]<- gsub(3,"WALKING_DOWNSTAIRS",dataset[,2])
# Replace 4 to SITTING
dataset[,2]<- gsub(4,"SITTING",dataset[,2])
# Replace 5 to STANDING
dataset[,2]<- gsub(5,"STANDING",dataset[,2])
# Replace 6 to LAYING
dataset[,2]<- gsub(6,"LAYING",dataset[,2])

# 4. Appropriately labels the data set with descriptive variable names.
# Reading labels(features);
datasetlabels<- read.csv(".//getdata_projectfiles_UCI HAR Dataset//UCI HAR Dataset//features.txt",sep = "",header = FALSE)
# Vector of labels
labelsvec <- as.character(datasetlabels$V2)
# Adding labels to datasetmean  
datasetmean<-cbind(labelsvec,datasetmean)
# Adding labels to datasetsd
datasetsd<-cbind(labelsvec,datasetsd)
# Combining "subject", "activity" with labels;
labelsvec2 <- c("subject","activity",labelsvec)

# 5. From the data set in step 4, creates a second, independent tidy data set with the average of each variable for each activity and each subject.
# Filtering each dataset by activity
# Load dplyr packege
library(dplyr)
# Changing names of 1ยบ and 2ยบ columns
colnames(dataset)[1] <- "subject"
colnames(dataset)[2] <- "activity"
# Group by subject and activity  
byactsub <- dataset %>% group_by(subject,activity)
# getting the mean
datasetbyactsub <- byactsub %>% summarise_all(mean)

# datasets with descriptive variable names
colnames(dataset) <- labelsvec2
# datasetbyactsub with descriptive variable names
colnames(datasetbyactsub) <- labelsvec2

# Saving files
# tidydata
write.csv(dataset,".\\tidydatasets\\tidydata.csv", row.names = FALSE)
# datasetbyactsub
write.csv(datasetbyactsub,".\\tidydatasets\\tidydatamean.csv", row.names = FALSE)
write.table(datasetbyactsub, file = ".\\tidydatasets\\tidydatamean.txt", row.name=FALSE)
# datasetmean
write.csv(datasetmean,".\\tidydatasets\\datasetmean.csv", row.names = FALSE)
# datasetsd
write.csv(datasetsd,".\\tidydatasets\\datasetsd.csv", row.names = FALSE)
